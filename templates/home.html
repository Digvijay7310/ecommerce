{% extends "base.html" %}
{% block content %}

<h2 class="text-xl text-center mb-4">Products</h2>

<div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4">

{% for product in products %}
  <div class="bg-white shadow rounded p-2 relative">

    <a href="{% url 'product_detail' product.id %}">
      <img src="{{ product.main_image.url }}" class="h-40 mx-auto mb-2">
      <h3 class="text-sm line-clamp-2">{{ product.name }}</h3>
      <p class="font-bold">â‚¹{{ product.price }}</p>
    </a>

    {% if not request.user.is_authenticated %}
      <!-- NOT LOGGED IN -->
      <a href="{% url 'login' %}"
         class="block mt-2 bg-blue-600 text-white text-center py-2 rounded">
        Login to Add
      </a>

    {% else %}
      <!-- LOGGED IN -->
      {% with qty=0 %}
        {% for item in cart_items %}
          {% if item.product.id == product.id %}
            {% with qty=item.quantity %}{% endwith %}
          {% endif %}
        {% endfor %}

        {% if qty > 0 %}
          <div class="mt-2 bg-green-700 text-white text-center py-2 rounded">
            In Cart: {{ qty }}
          </div>
        {% else %}
          <a href="{% url 'add_to_cart' product.id %}"
             class="block mt-2 bg-green-700 text-white text-center py-2 rounded">
            Add to Cart
          </a>
        {% endif %}
      {% endwith %}
    {% endif %}

  </div>
{% endfor %}

</div>
{% endblock %}
